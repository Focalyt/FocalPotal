<% include ../partials/header %>
    <div class="content-header row d-xl-block d-lg-block d-md-none d-sm-none d-none">
        <div class="content-header-left col-md-9 col-12 mb-2">
            <div class="row breadcrumbs-top">
                <div class="col-12">
                    <h3 class="content-header-title float-left mb-0">Add Post</h3>
                    <div class="breadcrumb-wrapper col-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/admin">Home</a></li>
                            <li class="breadcrumb-item active">Add Post</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="content-body">
        <% include ../partials/flash %>
        <form  id="post-form" enctype="multipart/form-data">
            <!-- Input Group for Post -->
            <div class="input-group">
              <!-- Text Input -->
              <textarea name="content" id= "post-content" class="form-control" rows="3" placeholder="What's on your mind?" required></textarea>
              <!-- Media Button -->
              <div class="ml-3">
                <label for="file-upload" class="media-btn">
                  <img src="https://static.xx.fbcdn.net/rsrc.php/v4/y7/r/Ivw7nhRtXyo.png" alt="Media Icon"> <!-- Facebook Media Icon -->
                  Photo/Video
                </label>
                <input type="file" id="file-upload" name="file" class="d-none" multiple accept="image/*,video/*">
              </div>
              
            </div>
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary mt-3">Post</button>
          </form>


    </div>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>




    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- <script src="https://cdn.ckeditor.com/ckeditor5/37.0.0/classic/ckeditor.js"></script> -->
    

    <script>
        $(document).ready(function () {
            // Handle form submission
            $("#post-form").on("submit", function (e) {
                e.preventDefault(); // Prevent the default form submission
    
                
                const formData = new FormData();
formData.append("content", $("#post-content").val());
const files = $("#file-upload")[0].files;
console.log("Content:", $("#post-content").val());
console.log("Files:", files);
for (let i = 0; i < files.length; i++) {
  formData.append("files", files[i]);
  console.log(`File ${i + 1}:`, files[i].name);
}
    
                // Show a loading spinner or disable the submit button (optional)
                $("button[type=submit]").text("Posting...").attr("disabled", true);
    
                // Send data to the API
                $.ajax({
                    url: "/api/postfiles", // API endpoint
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        // Handle successful response
                        console.log("Response:", response);
                        alert("Post created successfully!");
                        // Optionally clear the form
                        $("#post-form")[0].reset();
                        $("button[type=submit]").text("Post").attr("disabled", false);
                    },
                    error: function (xhr, status, error) {
                        // Handle error response
                        console.error("Error:", error);
                        alert("Failed to create post. Please try again.");
                        $("button[type=submit]").text("Post").attr("disabled", false);
                    },
                });
            });
        });
    </script>

        
    <% include ../partials/footer %>
        </div>